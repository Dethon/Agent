---
phase: 03-streaming-performance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - WebChat.Client/wwwroot/css/app.css
  - WebChat.Client/Components/ChatMessage.razor
autonomous: true

must_haves:
  truths:
    - "Blinking cursor appears at end of streaming message content"
    - "Typing indicator shows animated dots while waiting for first token"
    - "Error recovery CSS classes are defined for future error state UI (wired in Phase 4)"
    - "Visual feedback uses CSS animations (no JavaScript re-renders)"
  artifacts:
    - path: "WebChat.Client/wwwroot/css/app.css"
      provides: "CSS animations for streaming cursor, typing indicator, error recovery"
      contains: "streaming-cursor"
    - path: "WebChat.Client/Components/ChatMessage.razor"
      provides: "Streaming cursor class applied during active streaming"
      contains: "streaming-cursor"
  key_links:
    - from: "WebChat.Client/Components/ChatMessage.razor"
      to: "app.css"
      via: "CSS class streaming-cursor"
      pattern: "streaming-cursor"
---

<objective>
Add CSS-only visual feedback for streaming: blinking cursor, typing indicator, and error recovery UI styling.

Purpose: Provide smooth visual feedback during streaming that doesn't require JavaScript re-renders. CSS animations are hardware-accelerated and don't block the UI thread.

Output: CSS animations for streaming cursor and typing indicator; updated ChatMessage component with cursor display; error recovery button styling (classes only - component wiring deferred to Phase 4 SignalR Integration where error states are handled).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-streaming-performance/03-CONTEXT.md
@.planning/phases/03-streaming-performance/03-RESEARCH.md
@WebChat.Client/wwwroot/css/app.css
@WebChat.Client/Components/ChatMessage.razor
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CSS animations for streaming visual feedback</name>
  <files>WebChat.Client/wwwroot/css/app.css</files>
  <action>
Add CSS at end of app.css (before responsive section) for streaming visual feedback:

1. **Blinking cursor** - appears at end of streaming content:
```css
/* Streaming Cursor */
.streaming-cursor .message-content::after {
    content: "|";
    color: var(--accent);
    font-weight: bold;
    animation: cursor-blink 1s step-end infinite;
    margin-left: 2px;
}

@keyframes cursor-blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
}
```

2. **Typing indicator enhancement** - update existing .streaming-indicator to be more prominent:
```css
/* Typing Indicator (waiting for first token) */
.typing-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 1.25rem;
    color: var(--text-secondary);
}

.typing-indicator .typing-dots {
    display: flex;
    gap: 4px;
}

.typing-indicator .typing-dots span {
    width: 8px;
    height: 8px;
    background-color: var(--accent);
    border-radius: 50%;
    animation: typing-pulse 1.4s infinite ease-in-out both;
}

.typing-indicator .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
.typing-indicator .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
.typing-indicator .typing-dots span:nth-child(3) { animation-delay: 0s; }

@keyframes typing-pulse {
    0%, 80%, 100% {
        transform: scale(0.6);
        opacity: 0.5;
    }
    40% {
        transform: scale(1);
        opacity: 1;
    }
}
```

3. **Error recovery button** - inline retry styling (CSS only, component wiring in Phase 4):
```css
/* Streaming Error Recovery (component wiring in Phase 4 - SignalR Integration) */
.streaming-error {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.streaming-error .error-text {
    color: var(--error);
}

.streaming-error .retry-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--bg-tertiary);
    border: 1px solid var(--error);
    border-radius: 8px;
    color: var(--error);
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-normal);
    width: fit-content;
}

.streaming-error .retry-btn:hover {
    background: var(--error);
    color: white;
}

/* Reconnecting state */
.streaming-reconnecting {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0;
    color: var(--text-muted);
    font-size: 0.8125rem;
}

.streaming-reconnecting .spinner-small {
    width: 14px;
    height: 14px;
    border: 2px solid var(--border-color);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}
```

4. **Error banner** (full-width, after all retries fail):
```css
/* Full Error Banner */
.error-banner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    background: var(--error-bg);
    border: 1px solid var(--error-border);
    border-radius: 10px;
    margin-bottom: 1rem;
}

.error-banner .error-message {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--error);
    font-size: 0.875rem;
}

.error-banner .banner-retry-btn {
    padding: 0.375rem 0.75rem;
    background: transparent;
    border: 1px solid var(--error);
    border-radius: 6px;
    color: var(--error);
    font-size: 0.8125rem;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-normal);
}

.error-banner .banner-retry-btn:hover {
    background: var(--error);
    color: white;
}
```

NOTE: Error recovery CSS classes (.streaming-error, .streaming-reconnecting, .error-banner) are STYLING ONLY in this phase. The component wiring that applies these classes based on SignalR connection state is deferred to Phase 4 (SignalR Integration) where the connection error handling logic lives.
  </action>
  <verify>CSS file is valid (no syntax errors) - check by loading the app</verify>
  <done>CSS animations added for streaming cursor, typing indicator, error recovery UI styling</done>
</task>

<task type="auto">
  <name>Task 2: Update ChatMessage component with streaming cursor</name>
  <files>WebChat.Client/Components/ChatMessage.razor</files>
  <action>
Update ChatMessage.razor to apply streaming-cursor class:

1. Modify GetMessageClass() to include "streaming-cursor" when IsStreaming is true AND message has content:
```csharp
private string GetMessageClass()
{
    var classes = new List<string> { "chat-message", Message.Role };
    if (Message.IsError)
    {
        classes.Add("error");
    }
    // Add cursor class when actively streaming with content
    if (IsStreaming && !string.IsNullOrEmpty(Message.Content))
    {
        classes.Add("streaming-cursor");
    }
    return string.Join(" ", classes);
}
```

2. Update the streaming indicator section to show typing indicator ONLY when no content yet:
```razor
@if (IsStreaming)
{
    @if (string.IsNullOrEmpty(Message.Content))
    {
        <div class="typing-indicator">
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <span>Thinking...</span>
        </div>
    }
}
```

The existing streaming-indicator div should be replaced/updated to be the typing-indicator that only shows when content is empty.

Result:
- While waiting for first token: typing indicator (animated dots + "Thinking...")
- While streaming content: blinking cursor at end via CSS ::after pseudo-element
- When streaming complete: no cursor (streaming-cursor class removed)
  </action>
  <verify>Build succeeds with `dotnet build WebChat.Client`</verify>
  <done>ChatMessage shows typing indicator while waiting, blinking cursor while streaming content</done>
</task>

</tasks>

<verification>
1. `dotnet build WebChat.Client` succeeds
2. CSS classes are properly defined (grep for "streaming-cursor" and "typing-indicator")
3. ChatMessage applies correct classes based on streaming state
</verification>

<success_criteria>
- Blinking cursor appears at end of streaming message content (CSS-only, no JS)
- Typing indicator with animated dots shows while waiting for first token
- Error recovery styling is ready for error states (component wiring deferred to Phase 4)
- All visual feedback is CSS-based (hardware-accelerated, no render overhead)
</success_criteria>

<output>
After completion, create `.planning/phases/03-streaming-performance/03-02-SUMMARY.md`
</output>
